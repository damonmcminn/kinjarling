{"version":3,"sources":["../es6/api.js"],"names":[],"mappings":";;;;;;;;sBAAqB,cAAc;;uBACf,SAAS;;;;oBACV,aAAa;;kBACjB,MAAM;;;;AAErB,SAAS,GAAG,CAAC,IAAI,EAAE;AACjB,SAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;CACnC;;AAED,IAAM,GAAG,GAAG,sBAAS,CAAC;;qBAEP,GAAG;;AAElB,GAAG,CAAC,GAAG,CAAC,MAXA,IAAI,EAWE,CAAC,CAAC;AAChB,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,UAAC,GAAG,EAAE,GAAG,EAAK;MAE3B,KAAK,GAAI,GAAG,CAAC,MAAM,CAAnB,KAAK;;AACV,MAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;;MAEf,KAAK,GAAI,GAAG,CAAC,OAAO,CAApB,KAAK;;;;;AAIV,MAAI,IAAI,GAAI,CAAC,KAAK,IAAI,QAvBhB,MAAM,CAuBiB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,AAAC,CAAC;;AAEpD,MAAI,IAAI,EAAE,OAAO,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AACrC,KAAG,CAAC,EAAC,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAL,KAAK,EAAE,IAAI,EAAJ,IAAI,EAAC,CAAC,CAAA;;AAE5D,kBAAG,EAAE,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;AACrC,KAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;CAErB,CAAC,CAAC","file":"es6/api.js","sourcesContent":["import {groups} from 'parse-config';\nimport express from 'express';\nimport {json} from 'body-parser';\nimport io from './io';\n\nfunction log(data) {\n  console.log(JSON.stringify(data));\n}\n\nconst api = express();\n\nexport default api;\n\napi.use(json());\napi.post('/:group', (req, res) => {\n\n  let {group} = req.params;\n  let data = req.body;\n\n  let {token} = req.headers;\n  // check token; payload includes providerId, exp\n  // check if group matches allowed groups\n\n  let deny = (!token || groups.indexOf(group) === -1);\n\n  if (deny) return res.sendStatus(403);\n  log({timestamp: new Date(), event: 'API call', group, data})\n\n  io.to(group).emit('broadcast', data);\n  res.sendStatus(200);\n\n});\n"]}