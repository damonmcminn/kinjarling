{"version":3,"sources":["../es6/io.js"],"names":[],"mappings":";;;;;;;;wBAAqB,WAAW;;;;2BACL,cAAc;;AAEzC,SAAS,GAAG,CAAC,IAAI,EAAE;AACjB,SAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;CACnC;;AAED,IAAM,EAAE,GAAG,sBAAS,EAAC,IAAI,eANjB,IAAI,AAMa,EAAC,CAAC,CAAC;;qBAEb,EAAE;;AAEjB,EAAE,CAAC,EAAE,CAAC,YAAY,EAAE,UAAA,MAAM,EAAI;gCACR,MAAM,CAAC,SAAS,CAAC,KAAK;MAArC,IAAI,2BAAJ,IAAI;MAAE,KAAK,2BAAL,KAAK;;AAEhB,KAAG,CAAC,EAAC,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,mBAAmB,EAAE,IAAI,EAAJ,IAAI,EAAE,KAAK,EAAL,KAAK,EAAC,CAAC,CAAA;AACrE,QAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;AAEnB,QAAM,CAAC,EAAE,CAAC,WAAW,EAAE,UAAA,IAAI,EAAI;AAC7B,OAAG,CAAC,EAAC,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAL,KAAK,EAAE,IAAI,EAAJ,IAAI,EAAE,IAAI,EAAJ,IAAI,EAAC,CAAC,CAAA;AAC1E,MAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;GACtC,CAAC,CAAC;CAEJ,CAAC,CAAC;;AAEH,EAAE,CAAC,GAAG,CAAC,eAAe,EAAE,UAAC,SAAS,EAAE,QAAQ,EAAK;0BAE3B,SAAS,CAAC,MAAM;MAA/B,KAAK,qBAAL,KAAK;MAAE,IAAI,qBAAJ,IAAI;;AAEhB,MAAI,IAAI,GAAG,aA3BC,MAAM,CA2BA,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;;AAExC,MAAI,IAAI,EAAE;AACR,OAAG,CAAC,EAAC,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAL,KAAK,EAAE,IAAI,EAAJ,IAAI,EAAC,CAAC,CAAA;AACxD,YAAQ,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;GAC7B,MAAM;AACL,YAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GACtB;CAEF,CAAC,CAAC","file":"es6/io.js","sourcesContent":["import socketIO from 'socket.io';\nimport {path, groups} from 'parse-config';\n\nfunction log(data) {\n  console.log(JSON.stringify(data));\n}\n\nconst io = socketIO({path});\n\nexport default io;\n\nio.on('connection', socket => {\n  let {user, group} = socket.handshake.query\n  \n  log({timestamp: new Date(), event: 'Client connection', user, group})\n  socket.join(group);\n\n  socket.on('broadcast', data => {\n    log({timestamp: new Date(), event: 'Client broadcast', group, data, user})\n    io.to(group).emit('broadcast', data);\n  });\n\n});\n\nio.set('authorization', (handshake, callback) => {\n\n  let {group, user} = handshake._query;\n\n  let deny = groups.indexOf(group) === -1;\n\n  if (deny) {\n    log({timestamp: new Date(), event: 'DENY', group, user})\n    callback(new Error('DENY'));\n  } else {\n    callback(null, true);\n  }\n\n});\n"]}